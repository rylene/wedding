<!DOCTYPE html>
<html>
<head>
<title>Title</title>
<link rel="stylesheet" href="style.css">
<style>
.full {
	position: fixed;
	top: 0;
	left: 0;
	width:100%;
	height:100vh;
	z-index: 1;
}
.content {
	background: #e1cbd7;
	display: flex;
	justify-content: center;
	align-items: center;
	font-family: sans-serif;
	color: #c81e26;
	font-size: 40px;

}
.video {
	object-fit: contain;
	background-color: #EEE1E4;
}
</style>
</head>
<body>
	<div class="full content">
		<div>page 3</div>
	</div>
	<img class="full video" src="v/r1-fs8.png"/>
	<div class="full content"  >
		<div>page 1</div>
	</div>
</body>
<script>
let pages = document.body.querySelectorAll(".full")
let video = document.body.querySelector(".video")
let pageHeight = pages[0].offsetHeight;
let totalHeight = pageHeight * pages.length;
let percent = 0;
document.body.style.minHeight = totalHeight + "px"

function onScroll() {
	window.requestAnimationFrame(onFrame);
}

function onFrame() {
	percent = window.scrollY / (totalHeight - pageHeight);
	pages[2].style.opacity = modulate(percent, [.1, .2], [1, 0], true)
	pages[1].style.opacity = modulate(percent, [.7, .8], [1, 0], true)
	var id = Math.round(modulate(percent, [.2, .8], [1, 60], true));
	video.src = `v/r${id}-fs8.png`
}

function modulate(value, rangeA, rangeB, limit) {
  let fromHigh, fromLow, result, toHigh, toLow
  if (limit == null) {
    limit = false
  }
  fromLow = rangeA[0]
  fromHigh = rangeA[1]
  toLow = rangeB[0]
  toHigh = rangeB[1]
  result = toLow + ((value - fromLow) / (fromHigh - fromLow)) * (toHigh - toLow)
  if (limit === true) {
    if (toLow < toHigh) {
      if (result < toLow) {
        return toLow
      }
      if (result > toHigh) {
        return toHigh
      }
    } else {
      if (result > toLow) {
        return toLow
      }
      if (result < toHigh) {
        return toHigh
      }
    }
  }
  return result
}


window.requestAnimationFrame(onFrame);
window.addEventListener("scroll", onScroll);
for (var i = 1; i <= 60; i++) {
	new Image().src = `v/r${i}-fs8.png`
}
</script>
</html>
